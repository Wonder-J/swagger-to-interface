"use strict";exports.__esModule=!0;var fs=require("fs"),shell=require("shelljs"),getTypeJudgeStr=function(e){var r,i;if("integer"===e.type)return"number";if("file"===e.type)return"API.File";if("string"===e.type)return e.enum?"'"+(null===(r=e.enum)||void 0===r?void 0:r.join("'|'"))+"'":"string";if("array"===e.type){if("integer"===e.items.type)return"number[]";if("number"===e.items.type)return"number[]";if("string"===e.items.type)return e.items.enum?"('"+(null===(i=e.enum)||void 0===i?void 0:i.join("'|'"))+"')[]":"string[]";if("file"===e.items.type)return"API.File[]";if(e.items.originalRef)return(null===(i=e.items.originalRef)||void 0===i?void 0:i.replace(/(«|»|,)/g,""))+"[]"}else if(null!=e&&e.originalRef)return null==e?void 0:e.originalRef;return e.type},writeService=function(e,r){var i=Object.keys(e),t=fs.createWriteStream("./interface/service.ts"),u="import {request} from 'umi'\n\n\n\n";i.forEach(function(r){var l=e[r];Object.keys(l).forEach(function(n){var e,o="export const "+l[n].operationId+" : (",s=[];null!==(e=null===(e=l[n])||void 0===e?void 0:e.parameters)&&void 0!==e&&e.forEach(function(e,r){var i,t="get"===n?"params"+(r||""):"data"+(r||"");e.type&&(o+=t+": "+getTypeJudgeStr(e)),e.schema&&(null!==(i=e.schema)&&void 0!==i&&i.originalRef?o+=t+": API."+getTypeJudgeStr(e.schema):o+=t+": "+getTypeJudgeStr(e.schema)),r+1<l[n].parameters.length&&(o+=","),s.push(t)}),null!==(e=null===(e=l[n])||void 0===e?void 0:e.responses[200])&&void 0!==e&&e.schema?o+=") => Promise<API."+(null===(e=null===(e=null===(e=l[n])||void 0===e?void 0:e.responses[200])||void 0===e?void 0:e.schema.originalRef)||void 0===e?void 0:e.replace(/(«|»|,)/g,""))+">":o+=") => Promise<any>",o+="=("+s.join(",")+")=>\n",o+="\trequest('"+r+"', {\n",o+="\tmethod: '"+n.toUpperCase()+"',\n",o+="\t"+("get"===n?"params":"data")+": {\n\t"+s.join(",")+"}})\n",u+=o})}),t.write(u,"utf-8"),t.on("finish",function(){shell.exec("prettier --write interface/api.d.ts && prettier --write interface/service.ts"),console.log("写完了")}),t.on("error",function(e){console.log(e)})};exports.default=writeService;